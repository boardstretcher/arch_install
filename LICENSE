#!/bin/bash

# Ask for the disk name
echo "Enter the disk name (e.g., /dev/sda):"
read DISK

# Ensure the disk exists
if [ ! -b "$DISK" ]; then
    echo "Error: Disk $DISK not found!"
    exit 1
fi

# Confirm user action
read -p "All data on $DISK will be lost! Are you sure? (yes/no) " CONFIRM
if [ "$CONFIRM" != "yes" ]; then
    echo "Operation canceled."
    exit 1
fi

# Unmount any mounted partitions of the selected disk
umount ${DISK}*

# Remove all partitions
echo "Deleting all partitions on $DISK..."
(
echo o # Delete all partitions
) | fdisk $DISK

# Create partitions
echo "Creating new partitions on $DISK..."
(
echo g   # Create GPT partition table
echo n   # New partition
echo 1   # Partition number 1
echo     # Default start sector
echo +2G # 2G EFI partition
echo t   # Change partition type
echo 1   # EFI System
echo n   # New partition
echo 2   # Partition number 2
echo     # Default start sector
echo +450G # 450G Linux partition
echo n   # New partition
echo 3   # Partition number 3
echo     # Default start sector
echo     # Use remaining space for swap
echo t   # Change partition type
echo 3   # Select partition number 3
echo 19  # Linux swap
echo w   # Write changes
) | fdisk $DISK

# Format partitions
echo "Formatting the EFI partition..."
mkfs.fat -F32 ${DISK}1

echo "Formatting the Linux partition..."
mkfs.ext4 ${DISK}2

echo "Setting up the swap partition..."
mkswap ${DISK}3
swapon ${DISK}3

echo "All done!"